# Contributor: Richard Mortier <mort@cantab.net>
# Maintainer: Richard Mortier <mort@cantab.net>
pkgname=shellcheck
pkgver=0.6.0
pkgrel=0
pkgdesc="Finds bugs in your shell scripts"
url="https://www.shellcheck.net/"
arch="all"
license="GPL-3.0-only"
depends=""
makedepends="ghc"
install=""
subpackages="$pkgname-doc"
source="${pkgname}-${pkgver}.tar.gz::https://github.com/koalaman/shellcheck/archive/v$pkgver.tar.gz"
builddir="$srcdir/${pkgname}-${pkgver}"
options="!check" # binary distribution

build() {
	cd "$builddir"

	runhaskell Setup configure -O \
		--disable-library-vanilla \
		--docdir="/usr/share/doc/${pkgname}" \
		--dynlibdir=/usr/lib \
		--enable-executable-dynamic \
		--enable-shared \
		--enable-tests \
		--libsubdir=\$compiler/site-local/\$pkgid \
		--prefix=/usr

    runhaskell Setup build

    runhaskell Setup register --gen-script
    sed -i -r -e "s|ghc-pkg.*update[^ ]* |&'--force' |" register.sh

    runhaskell Setup unregister --gen-script
    sed -i -r -e "s|ghc-pkg.*unregister[^ ]* |&'--force' |" unregister.sh
}

package() {
	cd "$builddir"
}

sha512sums="4e9575985fe914cb35444995212ac1afaa40b004dbbc86b5987bf8b65e20b14a0102c9c601dc061d604129a8e978021f22a11d682545cb7f07ec974495cfa387  shellcheck-0.6.0.tar.gz"
